name: BOM Check

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  bom-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Check for BOM in files
      run: |
        echo "Checking for BOM (Byte Order Mark) in text files..."
        
        # Find all text files with specified extensions
        files=$(git ls-files | grep -E "\.(js|ts|json|md|mjs|css|html|yml|yaml)$" || true)
        
        bom_files=()
        
        for file in $files; do
          if [ -f "$file" ]; then
            # Check if file starts with BOM (EF BB BF)
            if head -c 3 "$file" | xxd -p | grep -q "efbbbf"; then
              bom_files+=("$file")
            fi
          fi
        done
        
        if [ ${#bom_files[@]} -gt 0 ]; then
          echo "❌ BOM detected in the following files:"
          for file in "${bom_files[@]}"; do
            echo "  - $file"
          done
          echo ""
          echo "To remove BOM from these files, you can use:"
          echo "  sed -i '1s/^\xEF\xBB\xBF//' <filename>"
          echo "  or use your editor to save the file as UTF-8 without BOM"
          exit 1
        else
          echo "✅ No BOM detected in any files."
        fi
